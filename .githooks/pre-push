#!/bin/bash

# Colors for better output
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# Get the remote branch being pushed to
remote_branch=""
while read local_ref local_sha remote_ref remote_sha; do
    remote_branch=$(echo "$remote_ref" | sed 's/refs/heads\///')
    break
done

# Protected branches
protected_branches=("main" "develop")

# Check if trying to push to a protected branch
for branch in "${protected_branches[@]}"; do
    if [ "$remote_branch" = "$branch" ]; then
        echo ""
        echo "${RED}ðŸš« BLOCKED: Direct push to '$branch' branch${NC}"
        echo ""
        echo "${YELLOW}This action is not allowed for security reasons.${NC}"
        echo ""
        echo "${BLUE}Please follow this workflow instead:${NC}"
        echo "1. ${GREEN}Create a feature branch:${NC}"
        echo "   git checkout -b feature/your-feature-name"
        echo ""
        echo "2. ${GREEN}Push to your feature branch:${NC}"
        echo "   git push origin feature/your-feature-name"
        echo ""
        echo "3. ${GREEN}Create a pull request:${NC}"
        echo "   Go to GitHub and create a PR to merge into $branch"
        echo ""
        echo "${YELLOW}Current branch: $(git branch --show-current)${NC}"
        echo "${YELLOW}Attempting to push to: $remote_branch${NC}"
        echo ""
        exit 1
    fi
done

echo "${GREEN}âœ… Push allowed to $remote_branch${NC}"
exit 0 